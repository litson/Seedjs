<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <title>Seed test bed.</title>
    <style data-src="http://cdn.bootcss.com/bootstrap/3.3.6/css/bootstrap.min.css"></style>
    <style>
        body {
            font-family: "Microsoft yahei", Verdana, Arial, Helvetica, sans-serif;
        }

        .wrapper {
            margin: 50px 10%;
        }

        .input {
            position: fixed;
            width: 40%;
            right: 10px;
            overflow: hidden;
            display: block;

            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 1rem;

            background-color: #000;

            color: #fff;
        }

        .input textarea {
            border: none;
            outline: none;
            display: block;
            background-color: transparent;
            width: 100%;
            min-height: 800px;
            padding-bottom: 10rem;
        }

        #preview {
            width: 60%;
            min-height: 500px;
            padding-bottom: 10rem;
            margin-right: 1rem;

            float: left;
        }

    </style>
</head>
<body>

<div class="wrapper" style="display: none">

    <div id="preview"></div>

    <div class="input">
        <textarea id="input" cols="30" rows="10"></textarea>
    </div>

</div>


<script data-src="http://cdn.bootcss.com/jquery/3.0.0-beta1/jquery.min.js"></script>
<script data-src="http://cdn.bootcss.com/markdown.js/0.5.0/markdown.min.js"></script>
<script src="../dist/seed.js"></script>
<script>

    /* global markdown */

    // 调试模式开启，不会存储资源
    Seed.data.debug = false;

    //
    Seed.data.delimiter = 'src';

    //
    Seed.data.map = function ( url ) {
        var datas  = url.match( /^(.*\/)(.*)$/i );
        var result = {
            id     : datas[2],
            fileUrl: url,
            hook   : datas[1]
        };
        console.log(
                // 版本号处于地址之间的情况，demo输入如下，已文件名为id，hook采用文件名之前的所有
                JSON.stringify(
                        result,
                        null,
                        4
                )
        );
        return result;
    };

    /**
     * 资源加载完毕
     */
    Seed.scan( function () {

        var documentString = Seed.getItem( 'documents' );

        var $preview = $( '#preview' );
        var $input   = $( '#input' );

        if ( documentString ) {
            bindInput( documentString )
        } else {
            $.ajax(
                    {
                        url    : '../README.md',
                        success: function ( data ) {
                            bindInput( data );
                        }
                    }
            )
        }

        function bindInput( documentString ) {
            $( '.wrapper' ).fadeIn();
            $input.val( documentString );
            $input.on( 'input', function () {
                var value = this.value;
                $preview.html(
                        markdown.toHTML( value )
                );
                Seed.setItem( 'documents', value );
            } ).trigger( 'input' );
        }
    } );
</script>
</body>
</html>